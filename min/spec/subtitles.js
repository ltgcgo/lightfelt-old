window.Subtitle||(Subtitle=function(t,e,s,i){if(t.constructor!=Number)throw new TypeError("Invalid start time: must be a number");if(!(t>=0))throw new RangeError("Invalid start time: $1 must be a positive number".replace("$1",t));if(this.start=t,e.constructor!=Number)throw new TypeError("Invalid end time: must be a number");if(!(e>=0))throw new RangeError("Invalid end time: $1 must be a positive number".replace("$1",e));if(this.end=e,s.constructor!=String)throw new TypeError("Invalid text: must be a string");if(this.text=s,i.constructor!=Object)throw new TypeError("Invalid property: must be an object");this.prop=i});class SubtitlesList extends Array{}window.Subtitles||(Subtitles=function(t){if(t){for(;-1!=t.search("\r\n");)t=t.replace("\r\n","\n");this.text=t}this.metaInfo={},this.import={srt:t=>{let e=new Date;if(t=t||this.text,this.text=t,!t)throw new Error("Invalid SRT text");let s=(t=t.trim()).split("\n\n"),i=0,r=0;for(;r<s.length;){if(s[r]=s[r].split("\n"),parseInt(s[r][0].trim()).toString()==s[r][0].trim()?shift=1:shift=0,s[r][shift]=s[r][shift].trim(),-1==s[r][shift].search("--\x3e"))throw new Error("Invalid SRT text: timeline not found at item $1".replace("$1",r+1));{for(s[r][shift]=s[r][shift].replace(" --\x3e","--\x3e"),s[r][shift]=s[r][shift].replace("--\x3e ","--\x3e");-1!=s[r][shift].search("  ");)s[r][shift]=s[r][shift].replace("  "," ");let t=s[r][shift].split(" "),e=s[r][shift].split("--\x3e")[0],l=s[r][shift].split("--\x3e")[1];for(;-1!=e.search(",");)e=e.replace(",",".");for(;-1!=l.search(",");)l=l.replace(",",".");e=e.split(":"),l=l.split(":");let o=0;for(i=0;i<e.length;)o+=parseFloat(e[e.length-1-i])*Math.pow(60,i),i++;o=Math.round(100*o)/100;let a=0;for(i=0;i<l.length;)a+=parseFloat(l[l.length-1-i])*Math.pow(60,i),i++;a=Math.round(100*a)/100;let n="";for(i=shift+1;i<s[r].length;)n+="\n"+s[r][i],i++;for(n=n.replace("\n",""),i=shift+1,prop={};i<t.length;){let e=t[i].split(":")[0],s=t[i].split(":")[1];prop[e]=s,i++}this.list[this.list.length]=new Subtitle(o,a,n,prop),this.type="SRT"}r+=1}let l=new Date;return window.debugMode&&console.log("SRT parsing took "+(l.getMilliseconds()-e.getMilliseconds())+"ms."),this},lrc:t=>{}},this.import.vtt=t=>{t=t.replace("WEBVTT\n",""),this.import.srt(t)},this.import.ass=t=>{t=t||this.text;let e={},s=t.split("\n"),i="",r=[],l=[];s.forEach((t,s)=>{let o=t.trim();if(""==o)0;else switch(o.toLowerCase()){case"[script info]":e.scriptInfo=s,i="info";break;case"[v4 styles]":case"[v4+ styles]":e.styles=s,i="styles";break;case"[events]":e.events=s,i="events";break;case"[fonts]":e.fonts=s,i="fonts";break;case"[graphics]":e.graphics=s,i="graphics";break;default:switch(i){case"info":if(";"!=o[0]){let t=o.split(":");t.forEach((e,s)=>{t[s]=e.trim()}),this.metaInfo[t[0]]=t[1]}break;case"styles":if(";"!=o[0]){let t=o.split(":");t.forEach((e,s)=>{t[s]=e.trim()}),"Format"==t[0]?(r=t[1].split(","),r.forEach((t,e)=>{r[e]=t.trim()})):t[0]}break;case"events":if(";"!=o[0]){let t=o.split(":");if(t.forEach((e,s)=>{t[s]=e.trim()}),"Format"==t[0])l=t[1].split(","),l.forEach((t,e)=>{l[e]=t.trim()});else if("Dialogue"==t[0]){let t=o.replace("Dialogue:","").trim(),e="";t.split(",").forEach((t,s)=>{if(s>=l.length)e+=","+t;else switch(l[s].toLowerCase()){case"start":case"end":break;case"text":e=t}}),console.info(e)}}}}}),window.debugMode&&console.info("Structure: %o",e),this.type="ASS"},this.export={srt:()=>{},lrc:()=>{}},this.type="",this.list=new SubtitlesList,this.lastMatches=new SubtitlesList,this.currentSub=t=>{let e=new Date;t=this.monitor?this.monitor.time:t||0,pos=0;let s=this.list.length,i=Math.round(Math.sqrt(s)),r=Math.ceil(s/i),l=new SubtitlesList;window.debugMode&&console.log("Seperated list search in $1 chunks, $2 elements in each chunk, $3 elements in the last chunk.".replace("$1",r).replace("$2",i).replace("$3",s-i*r+i));let o=0;for(;o<this.lastMatches.length;){if(this.lastMatches[o].start<=t&&this.lastMatches[o].end>=t&&(l[l.length]=this.lastMatches[o]),this.lastMatches[o].end<t||this.lastMatches[o].start>t){let t=this.lastMatches.splice(o,1);window.debugMode&&console.warn("Expired subtitle: %o",t)}o++}for(o=0;o<r&&!(t<this.list[0].start)&&o+2<=r&&!(this.list[pos].start<=t&&this.list[pos+i].start>=t);)pos+=i,o++;for(o=0;o<i;)this.list[pos].start<=t&&this.list[pos].end>=t&&-1==l.indexOf(this.list[pos])&&(l[l.length]=this.list[pos]),pos+1<this.list.length&&pos++,o++;let a=new Date;return window.debugMode&&console.log("Searching took "+(a.getMilliseconds()-e.getMilliseconds())+"ms."),this.lastMatches=l,l}});